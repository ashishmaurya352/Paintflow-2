<ion-header [translucent]="true">
  <div class="hader">
    <ion-item>
      <ion-button fill="clear" slot="start" aria-label="Show/hide" (click)="backToRequisitionPage()">
        <ion-icon color="dark" slot="icon-only" name="arrow-back" aria-hidden="true"></ion-icon>
      </ion-button>
      <h3>{{'Pending Requisitions'}}</h3>
      <ion-button fill="clear" slot="end" aria-label="Show/hide" id="popover-button" (click)="openFilter()">
        <ion-icon color="dark" slot="icon-only" name="filter-outline" aria-hidden="true"></ion-icon>
      </ion-button>
    </ion-item>
  </div>
</ion-header>


<ion-content class="ion-padding">
  <ion-grid class="time-period">
  <ion-row class="ion-align-items-center ion-justify-content-between">

    <!-- Left Section -->
    <ion-col size="12" size-md="6" class="left-section">
      <ion-button class="download-report" fill="outline" shape="round" (click)="downloadReport()">
        <ion-icon slot="start" name="cloud-download-outline"></ion-icon>
        Download Report
      </ion-button>

      <!-- Searchable Dropdown Trigger -->
      <ion-button fill="outline" shape="round" (click)="openDropdown()">
        {{ selectedOption || 'Select Slip' }}
        <ion-icon slot="end" name="chevron-down-outline"></ion-icon>
      </ion-button>
    </ion-col>

    <!-- Right Section -->
    <ion-col size="12" size-md="6" class="right-section">
      <div class="time-buttons">
        <ion-button *ngFor="let period of timePeriods"
                    fill="clear"
                    size="small"
                    [ngClass]="{'active': selectedPeriod === period.label}"
                    (click)="setActive(period.label)">
          {{ period.label }}
        </ion-button>

        <ion-button *ngIf="selectedPeriod !== 'Custom Date'"
                    fill="clear"
                    size="small"
                    [ngClass]="{'active': selectedPeriod === 'Custom Date'}"
                    (click)="setActive('Custom Date')">
          <ion-icon name="calendar-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- Custom Date Picker -->
      <div *ngIf="selectedPeriod === 'Custom Date'" class="custom-date">
        <ion-button shape="round" id="startDate-trigger" [fill]="sortByName === 'startDate' ? 'solid' : 'outline'">
          <ion-icon name="calendar"></ion-icon>
          {{ startDate | date: 'mediumDate':'IST' }}
        </ion-button>

        <ion-button shape="round" id="endDate-trigger" [fill]="sortByName === 'endDate' ? 'solid' : 'outline'">
          <ion-icon name="calendar"></ion-icon>
          {{ endDate | date: 'mediumDate':'IST' }}
        </ion-button>

        <!-- Date Popovers -->
        <ion-popover trigger="startDate-trigger">
          <ng-template>
            <ion-datetime presentation="date"
                          [value]="calStartDate"
                          (ionChange)="onStartDateChange($event)"
                          [showDefaultButtons]="true">
            </ion-datetime>
          </ng-template>
        </ion-popover>

        <ion-popover trigger="endDate-trigger">
          <ng-template>
            <ion-datetime presentation="date"
                          [value]="calEndDate"
                          [min]="calStartDate"
                          (ionChange)="onEndDateChange($event)"
                          [showDefaultButtons]="true">
            </ion-datetime>
          </ng-template>
        </ion-popover>
      </div>
    </ion-col>

  </ion-row>
</ion-grid>

<!-- Searchable Dropdown Modal -->
<ion-modal [isOpen]="dropdownOpen" (didDismiss)="closeDropdown()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="light">
        <ion-title>Select Option</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeDropdown()">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-searchbar placeholder="Search..." [debounce]="1000" (ionInput)="onSearchInput($event)"></ion-searchbar>
      <ion-list>
        <ion-item button *ngFor="let option of filteredOptions" (click)="selectOption(option)">
          {{ option?.slipNumber }}
        </ion-item>
      </ion-list>
      <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)" *ngIf="hasMoreData">
        <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more..."></ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </ion-content>
  </ng-template>
</ion-modal>


  <ion-grid>
      <ion-row>
        <ion-col >
          <ion-card class="requisition-card">
            <ion-card-content class="overview">
              <h3>Total Quantity: {{ tableData.totalQuantity | number:'1.3-3' }}</h3>
            </ion-card-content>
          </ion-card>
        </ion-col>
         <ion-col >
          <ion-card class="requisition-card">
            <ion-card-content class="overview">
              <h3>Total Pending: {{ tableData.totalPendingSqFt | number:'1.3-3' }}</h3>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ReqDate</th>
          <th>SlipNumber</th>
          <th>CO Number</th>
          <th>Person</th>
          <th>Pending SqFt</th>
          <th>Sum of Quantity</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of tableData.data; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{addISTOffset(item.reqDate) | date:'mediumDate'}}</td>
          <td>{{ item.slipNumber }}</td>
          <td>{{ item.coNumber }}</td>
          <td>{{ item.person }}</td>
          <td>{{ item.pendingSqFt }}</td>
          <td>{{ item.sumOfQuantity }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!tableData.data || tableData.data.length === 0" style="display: flex; justify-content: center;">
    <p>No Data </p>
  </div>

</ion-content>